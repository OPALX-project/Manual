ifdef::env-gitlab[]
:stem: latexmath
:sectnums:
:toc: macro
:toclevels: 3

link:home[Back to Main Page]

toc::[]
endif::[]

[[chp.partmatter]]
== Physics Models Used in the Particle Matter Interaction Model

The command to define the particle matter interacton is
PARTICLEMATTERINTERACTION.

MATERIAL::
  The material of the surface.
ENABLERUTHERFORD::
  Switch to disable Rutherford scattering, default true.

The so defined instance has then to be added to an element using the
attribute

[[sec.partmatter.the-energy-loss]]
=== The Energy Loss

The energy loss is simulated using the Bethe-Bloch equation.


[latexmath]
++++
-\frac{\mathrm{d} E}{\mathrm{d} x}=\frac{K z^2 Z}{A \beta^2}\left[\frac{1}{2} \ln{\frac{2 m_e c^2\beta^2 \gamma^2 Tmax}{I^2}}-\beta^2 \right],
++++


where latexmath:[Z] is the atomic number of absorber, latexmath:[A]
is the atomic mass of absorber, latexmath:[m_e] is the electron mass,
latexmath:[z] is the charge number of the incident particle,
latexmath:[K=4\pi N_Ar_e^2m_ec^2], latexmath:[r_e] is the classical
electron radius, latexmath:[N_A] is the Avogadro’s number,
latexmath:[I] is the mean excitation energy. latexmath:[\beta] and
latexmath:[\gamma] are kinematic variables. latexmath:[T_{max}] is
the maximum kinetic energy which can be imparted to a free electron in a
single collision.

[latexmath]
++++
T_{max}=\frac{2m_ec^2\beta^2\gamma^2}{1+2\gamma m_e/M+(m_e/M)^2},
++++

where latexmath:[M] is the incident particle mass.

The stopping power is compared with PSTAR program of NIST in
<<fig_PSTAR>>.

.The comparison of stopping power with PSTAR.
[[fig_PSTAR,Figure {counter:fig-cnt}]]
image::figures/partmatter/dEdx.png[scaledwidth=12cm]

Energy straggling: For relatively thick absorbers such that the number
of collisions is large, the energy loss distribution is shown to be
Gaussian in form. For non-relativistic heavy particles the spread
latexmath:[\sigma_0] of the Gaussian distribution is calculated by:

[latexmath]
++++
\sigma_0^2=4\pi N_Ar_e^2(m_ec^2)^2\rho\frac{Z}{A}\Delta s,
++++

where latexmath:[\rho] is the density, latexmath:[\Delta s] is the
thickness.

[[sec.partmatter.the-coulomb-scattering]]
=== The Coulomb Scattering

The Coulomb scattering is treated as two independent events: the
multiple Coulomb scattering and the large angle Rutherford scattering. +
Using the distribution given in Classical Electrodynamics, by J. D.
Jackson, the multiple- and single-scattering distributions can be
written: 

[latexmath]
++++
P_M(\alpha) \;\mathrm{d} \alpha=\frac{1}{\sqrt{\pi}}e^{-\alpha^2}\;\mathrm{d}\alpha,
++++

[latexmath]
++++
P_S(\alpha) \;\mathrm{d} \alpha=\frac{1}{8 \ln(204 Z^{-1/3})} \frac{1}{\alpha^3}\;\mathrm{d}\alpha,
++++

where
latexmath:[\alpha=\frac{\theta}{<\Theta^2>^{1/2}}=\frac{\theta}{\sqrt 2 \theta_0}].

The transition point is
latexmath:[\theta=2.5 \sqrt 2 \theta_0\approx3.5 \theta_0],

[latexmath]
++++
\theta_0=\frac{{13.6}{MeV}}{\beta c p} z \sqrt{\Delta s/X_0} [1+0.038 \ln(\Delta s/X_0)],
++++

where latexmath:[p] is the momentum, latexmath:[\Delta s] is the
step size, and latexmath:[X_0] is the radiation length.

[[sec.partmatter.multiple-coulomb-scattering]]
==== Multiple Coulomb Scattering

Generate two independent Gaussian random variables with mean zero and
variance one: latexmath:[z_1] and latexmath:[z_2]. If
latexmath:[z_2 \theta_0>3.5 \theta_0], start over. Otherwise,

[latexmath]
++++
x=x+\Delta s p_x+z_1 \Delta s \theta_0/\sqrt{12}+z_2 \Delta s \theta_0/2,
++++

[latexmath]
++++
p_x=p_x+z_2 \theta_0.
++++

Generate two independent Gaussian random
variables with mean zero and variance one: latexmath:[z_3] and
latexmath:[z_4]. If latexmath:[z_4 \theta_0>3.5 \theta_0], start
over. Otherwise, 

[latexmath]
++++
y=y+\Delta s p_y+z_3 \Delta s \theta_0/\sqrt{12}+z_4 \Delta s \theta_0/2,
++++


[latexmath]
++++
p_y=p_y+z_4 \theta_0.
++++

[[sec.partmatter.large-angle-rutherford-scattering]]
==== Large Angle Rutherford Scattering

Generate a random number latexmath:[\xi_1], _if_
latexmath:[\xi_1 < \frac{\int_{2.5}^\infty P_S(\alpha)d\alpha}{\int_{0}^{2.5} P_M(\alpha)\;\mathrm{d}\alpha+\int_{2.5}^\infty P_S(\alpha)\;\mathrm{d}\alpha}=0.0047],
sampling the large angle Rutherford scattering.

The cumulative distribution function of the large angle Rutherford
scattering is 

[latexmath]
++++
F(\alpha)=\frac{\int_{2.5}^\alpha P_S(\alpha) \;\mathrm{d} \alpha}{\int_{2.5}^\infty P_S(\alpha) \;\mathrm{d} \alpha}=\xi,
++++

where latexmath:[\xi] is a random variable. So

[latexmath]
++++
\alpha=\pm 2.5 \sqrt{\frac{1}{1-\xi}}=\pm 2.5 \sqrt{\frac{1}{\xi}}.
++++

Generate a random variable latexmath:[P_3], +
_if_ latexmath:[P_3>0.5]

[latexmath]
++++
\theta_{Ru}=2.5 \sqrt{\frac{1}{\xi}} \sqrt{2}\theta_0,
++++

_else_

[latexmath]
++++
\theta_{Ru}=-2.5 \sqrt{\frac{1}{\xi}} \sqrt{2}\theta_0.
++++


The angle distribution after Coulomb scattering is shown in
<<fig_Jackson>>. The line is from Jackson’s formula, and the points are
simulations with Matlab. For a thickness of latexmath:[\Delta s=1e-4]
latexmath:[m], latexmath:[\theta=0.5349 \alpha] (in degree).

.The comparison of Coulomb scattering with Jackson’s book.
[[fig_Jackson,Figure {counter:fig-cnt}]]
image::figures/partmatter/10steps.png[scaledwidth=12cm]


[[sec.partmatter.beam-stripping-physics]]
=== Beam Stripping physics

Beam stripping physics takes into account two different physical
processes: interaction with residual gas and electromagnetic stripping
(also called Lorentz stripping). Given the stochastic nature of
such interactions, the processes are modeled as a Monte Carlo method.

Both processes are described in the same way:
Assuming that particles are normally incident on a homogeneous medium
and that they are subjected to a process with a mean free path
latexmath:[\lambda] between interactions, the probability of suffering
an interaction before reaching a path length latexmath:[x] is:

[latexmath]
++++
P(x) = 1 - e^{-x/\lambda}
++++

where latexmath:[P(x)] is the statistic cumulative interaction
probability of the process.

[[sec.partmatter.residual-gas-interaction]]
==== Residual gas interaction

The mean free path of the interaction is related with the density of
interaction centers and the cross section: latexmath:[\lambda=1/N\sigma].
Assuming a beam flux incident in an ideal gas with density latexmath:[N]
(number of gas molecules per unit volume under the vacuum condition),
the number of particles interacting depends on the gas composition and
the different reactions to be considered. Thus, in agreement with
Dalton's law of partial pressures:

[latexmath]
++++
\frac{1}{\lambda_{total}}=\sum \frac{1}{\lambda_k}=N_{total}\cdot\sigma_{total}=\sum_jN_j\,\sigma^{j}_{total}=\sum_j\left(\sum_iN_j\,\sigma^{j}_{i}\right)
++++

where the first summation is over all gas components and the second
summation is over all processes for each component.

The fraction loss of the beam for unit of travelled length is:
latexmath:[f_g=1-e^{-\delta _s /\lambda_{total}}]. For a individual
particle, latexmath:[f_g] represents the interaction probability
and it is evaluated through an independent random variable
each step latexmath:[\delta _s].

Gas stripping could be applied for four different types of incoming
particles: negative hydrogen ions (latexmath:[H^-]), protons
(latexmath:[p]), neutral hydrogen atoms (latexmath:[H]) and hydrogen
molecule ions (latexmath:[H_2^+]). Single / Double - electron detachment
or capture reactions are considered for each of them.

Cross sections are calculated according to energy of the particle
employing analytic expressions fitted to cross section experimental data.
There are three different fitting expressions:

 *** Nakai function <<bib.nakai>>

[latexmath]
++++
\sigma_{qq'} = \sigma_0 \left[ f(E_1) + a_7\!\cdot\!f(E_1/a_8) \right]
++++

[latexmath]
++++
f(E) = \frac{ a_1\!\cdot\!\left(\!\displaystyle\frac{E}{E_R}\!\right)^{\!a_2} }{ 1+\left(\!\displaystyle\frac{E}{a_3}\!\right)^{\!a_2+a_4}\!\!+\left(\!\displaystyle\frac{E}{a_5}\!\right)^{\!a_2+a_6} }
++++

[latexmath]
++++
E_R = hcR_{\infty}\!\cdot\!\frac{m_H}{m_e}
++++

[latexmath]
++++
E_1 = E_0 - E_{th}
++++

where latexmath:[\sigma_0] is a convenient cross section unit
(latexmath:[\sigma_0 = 1\cdot 10^{-16}\,\text{cm}^2]), latexmath:[E_0] is the
incident projectile energy in keV, latexmath:[E_{th}] is the threshold energy
of reaction in keV, and the symbols latexmath:[a_i] denote adjustable parameters.

 *** Tabata function <<bib.tabata>>: A linear combination of the Nakai function,
improved and fitted with a greater number of experimental data.

 *** Barnett function <<bib.barnett>>:

[latexmath]
++++
\ln{[\sigma(E)]}=\frac{1}{2}a_0 + \sum_{i=1}^{k} a_i \cdot T_i(X)
++++

[latexmath]
++++
X=\frac{(\ln{E}-\ln{E_{min}})-(\ln{E_{max}}-\ln{E})}{\ln{E_{max}}-\ln{E_{min}}}
++++

where latexmath:[T_i] are the Chebyshev orthogonal polynomials.


[[sec.partmatter.electromagnetic-stripping]]
==== Electromagnetic stripping

In case of latexmath:[H^-], the second electron is slightly bounded, so
it is relevant to consider the detachement by the magnetic field. The
orthogonal component of the magnetic field to the median plane (read
from `Cyclotron` element), produces an electric field according to
Lorentz transformation, latexmath:[E\!=\!\gamma\beta cB]. The fraction
of particles dissociated by the electromagnetic field during a time
step latexmath:[\delta _t] is:

[latexmath]
++++
f_{em}=1-e^{\,-\,\delta _t/\gamma\tau}
++++

where latexmath:[\tau] is the particle lifetime in the rest frame, determined
theoretically <<bib.scherk>>:

[latexmath]
++++
\tau= \frac{4mz_T}{S_0N^2\hslash\,(1+p)^2\left(1-\displaystyle\frac{1}{2k_0z_t}\right)}\cdot\exp\!{\left(\frac{4k_0z_T}{3}\right)}
++++
where latexmath:[z_T\!=\!-\varepsilon_0/eE] is the outer classical turning radius,
latexmath:[\varepsilon_0] is the binding energy, latexmath:[p] is a polarization factor
of the ionic wave function, latexmath:[k_0^2\!=\!2m(-\varepsilon_0)/\hslash^2],
latexmath:[S_{\!0}] is a spectroscopy coefficient, and the normalization constant
is latexmath:[N=(2k_0(k_0+\alpha)(2k_0+\alpha))^{1/2} / \alpha], where
latexmath:[\alpha] is a parameter for the ionic potential function.


[[sec.partmatter.the-flow-diagram-of-collimatorphysics-class-in-opal]]
=== The Flow Diagram of _CollimatorPhysics_ Class in OPAL

.The diagram of CollimatorPhysics in _OPAL_.
[[fig_CollPhysics,Figure {counter:fig-cnt}]]
image::figures/partmatter/diagram.png[scaledwidth=16cm]

.The diagram of CollimatorPhysics in _OPAL_ (continued). 
[[fig_CollPhysics2,Figure {counter:fig-cnt}]]
image::figures/partmatter/Diagram2.png[scaledwidth=8cm]

[[sec.partmatter.the-substeps]]
==== The Substeps

Small step is needed in the routine of CollimatorPhysics.

If a large step is given in the main input file, in the file
_CollimatorPhysics.cpp_, it is divided by a integer number
latexmath:[n] to make the step size using for the calculation of
collimator physics less than 1.01e-12 s. As shown by
<<fig_CollPhysics>> and <<fig_CollPhysics2>> in the previous section, first we track one
step for the particles already in the collimator and the newcomers, then
another (n-1) steps to make sure the particles in the collimator
experience the same time as the ones in the main bunch.

Now, if the particle leave the collimator during the (n-1) steps, we
track it as in a drift and put it back to the main bunch when finishing
(n-1) steps.

[[sec.partmatter.available-materials-in-opal]]
=== Available Materials in _OPAL_

.List of materials with their parameters implemented in _OPAL_.
[[tab_List_of_Materials,Table {counter:tab-cnt}]]
[cols="^2,^1,^1,^1,^1,^1,^1,^1,^1,^2",options="header",]
|=======================================================================
|Material |Z |A |latexmath:[\rho] [latexmath:[g/cm^3]] |X0
[latexmath:[g/cm^2]] |A2 |A3 |A4 |A5 |_OPAL_ Name
|Aluminum |13 |26.98 |2.7 |24.01 |4.739 |2766 |164.5 |2.023E-02
|`Aluminum`

|BoronCarbide |26 |55.25 |2.48 |50.14 |3.963 |6065 |1243 |7.782e-3
|`BoronCarbide`

|AluminaAl2O3 |50 |101.96 |3.97 |27.94 |7.227 |11210 |386.4 |4.474e-3
|`AluminaAl2O3`


|Copper |29 |63.54 |8.96 |12.86 |4.194 |4649 |81.13 |2.242E-02 |`Copper`

|Graphite |6 |12.0172 |2.210 |42.7 |2.601 |1701 |1279 |1.638E-02
|`Graphite`

|GraphiteR6710 |6 |12.0172 |1.88 |42.7 |2.601 |1701 |1279 |1.638E-02
|`GraphiteR6710`

|Titan |22 |47.8 |4.54 |16.16 |5.489 |5260 |651.1 |8.930E-03 |`Titan`

|Air |7 |14 |0.0012 |37.99 |3.350 |1683 |1900 |2.513E-02 |`Air`

|Kapton |6 |12 |1.4 |39.95 |2.601 |1701 |1279 |1.638E-02 |`Kapton`

|Gold |79 |197 |19.3 |6.46 |5.458 |7852 |975.8 |2.077E-02 |`Gold`

|Water |10 |18 |1 |36.08 |2.199 |2393 |2699 |1.568E-02 |`Water`

|Mylar |6.702 |12.88 |1.4 |39.95 |3.35 |1683 |1900 |2.513E-02 |`Mylar`

|Beryllium |4 |9.012 |1.848 |65.19 |2.590 |966.0 |153.8 |3.475E-02
|`Beryllium`

|Molybdenum |42 |95.94 |10.22 |9.8 |7.248 |9545 |480.2 |5.376E-03
|`Molybdenum`
|=======================================================================

[[sec.partmatter.example-of-an-input-file]]
=== Example of an Input File

https://gitlab.psi.ch/OPAL/Manual-2.2/wikis/examples/particlematterinteraction.in[particlematterinteraction.in]

FX5 is a slit in x direction, the `APERTURE` is *POSITIVE*, the first
value in `APERTURE` is the left part, the second value is the right
part. FX16 is a slit in y direction, the `APERTURE` is *NEGATIVE*, the
first value in `APERTURE` is the down part, the second value is the up
part.

[[sec.partmatter.a-simple-test]]
=== A Simple Test

A cold Gaussian beam with latexmath:[\sigma_x=\sigma_y=5] mm. The
position of the collimator is from 0.01 m to 0.1 m, the half aperture in
y direction is latexmath:[3] mm. <<fig_protonscoll>> shows the
trajectory of particles which are either absorbed or deflected by a
copper slit. As a benchmark of the collimator model in _OPAL_,
<<fig_spectrum>> shows the energy spectrum and angle deviation at
z=0.1 m after an elliptic collimator.

.The passage of protons through the collimator.
[[fig_protonscoll,Figure {counter:fig-cnt}]]
image::figures/partmatter/longcoll6.png[scaledwidth=12cm]

.The energy spectrum and scattering angle at z=0.1 m
[[fig_spectrum,Figure {counter:fig-cnt}]]
image::figures/partmatter/spectandscatter.png[scaledwidth=12cm]

[[sec.partmatter.bibliography]]
=== References

[[bib.nakai,*[{counter:bib-cnt}]*]] <<bib.nakai>> Y. Nakai, T. Shirai, T. Tabata, and R. Ito, Cross sections for charge transfer of hydrogen atoms and ions colliding with gaseous atoms and
molecules, At. Dat. Nucl. Dat. Tabl., 37, 69-101 (1987).

[[bib.tabata,*[{counter:bib-cnt}]*]] <<bib.tabata>> T. Tabata and T. Shirai, Anayltic Cross Section for Collisions of H+, H2+, H3+, H, H2, and H- with Hydrogen Molecules, At. Dat. Nucl. Dat. Tabl., 76, 1-25 (2000).

[[bib.barnett,*[{counter:bib-cnt}]*]] <<bib.barnett>> C. F. Barnett, Atomic Data for Fusion Vol. I: Collisions of H, H2, He and Li atoms and ions atoms and molecules, ORNL-6086/V1 (1990).

[[bib.scherk,*[{counter:bib-cnt}]*]] <<bib.scherk>> L. R. Scherk. An improved value for the electron affinity of the negative hydrogen ion, Can. J. Phys., 57, 558–563 (1979).


// EOF
